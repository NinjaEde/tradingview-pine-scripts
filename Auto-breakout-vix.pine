//@version=5
strategy(
    "Auto Breakout Strategy mit VIX Heatmap Gate",
    overlay=true,
    initial_capital=100000,
    default_qty_type=strategy.percent_of_equity,
    default_qty_value=10
)

// =====================
// VIX HEATMAP REGIME
// =====================
vix   = request.security("CBOE:VIX", timeframe.period, close)
vix3m = request.security("CBOE:VIX3M", timeframe.period, close)

ratio = vix / vix3m

score = 0
score += ratio < 0.98 ? 1 : 0
score += ratio < 0.95 ? 1 : 0
score += vix < 20 ? 1 : 0
score += vix < 15 ? 1 : 0

regimeOK = score >= 3

// =====================
// BREAKOUT LOGIK
// =====================
lookback   = input.int(20, "Breakout Lookback")
volLen     = input.int(20, "Volume SMA")

highestHigh = ta.highest(high, lookback)
volConfirm  = volume > ta.sma(volume, volLen)

breakout = close > highestHigh[1] and volConfirm

// =====================
// ENTRY
// =====================
if breakout and regimeOK
    strategy.entry("Breakout Long", strategy.long)

// =====================
// EXIT (Basis, bewusst simpel)
// =====================
atrLen = input.int(14, "ATR Length")
atrMul = input.float(2.0, "ATR Stop Multiplier")

atr = ta.atr(atrLen)
strategy.exit(
    "Exit",
    from_entry="Breakout Long",
    stop=close - atr * atrMul
)

// =====================
// VISUALS
// =====================
bgcolor(
     score >= 3 ? color.new(color.green, 85) :
     score == 2 ? color.new(color.yellow, 85) :
     color.new(color.red, 85)
)

plot(highestHigh, "Breakout Level", color=color.orange)
